<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVD ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            min-height: 100vh;
        }

        .controls {
            width: 350px;
            background: white;
            padding: 30px;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .matrix-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .matrix-input input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
        }

        .matrix-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #f093fb;
            color: white;
        }

        .btn-reset {
            background: #e74c3c;
            color: white;
        }

        .status {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .status-text {
            color: #333;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.1s;
        }

        .presets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .presets button {
            padding: 8px;
            font-size: 12px;
            background: #f0f0f0;
            color: #333;
        }

        .info {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 5px;
            font-size: 13px;
            line-height: 1.6;
        }

        .info-label {
            color: #667eea;
            font-weight: bold;
        }

        #canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h1>ğŸ” SVD ì‹œë®¬ë ˆì´í„°</h1>
        
        <div class="section">
            <h3>í–‰ë ¬ A (2Ã—2)</h3>
            <div class="matrix-input">
                <input type="number" id="a11" value="3" step="0.5">
                <input type="number" id="a12" value="1" step="0.5">
                <input type="number" id="a21" value="1" step="0.5">
                <input type="number" id="a22" value="3" step="0.5">
            </div>
            <div class="presets">
                <button onclick="preset(2,0,0,1)">ìŠ¤ì¼€ì¼</button>
                <button onclick="preset(0,-1,1,0)">íšŒì „</button>
                <button onclick="preset(2,1,0,1)">ì „ë‹¨</button>
                <button onclick="preset(3,1,1,3)">ì¼ë°˜</button>
            </div>
        </div>

        <div class="section">
            <h3>ë³€í™˜ ì‹¤í–‰</h3>
            <button class="btn-primary" onclick="startDirect()">âš¡ ì§ì ‘ ë³€í™˜</button>
            <button class="btn-secondary" onclick="startSVD()">ğŸ”¬ SVD ë‹¨ê³„ë³„ ë³€í™˜</button>
            <button class="btn-reset" onclick="reset()">â†º ë¦¬ì…‹</button>
        </div>

        <div class="section">
            <div class="status">
                <div class="status-text" id="status">ëŒ€ê¸° ì¤‘...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>SVD ë¶„í•´ ê²°ê³¼</h3>
            <div class="info" id="svd-result">
                í–‰ë ¬ì„ ì…ë ¥í•˜ê³  ë³€í™˜ì„ ì‹œì‘í•˜ì„¸ìš”.
            </div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script>
        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        let isAnimating = false;
        let animationMode = null; // 'direct' or 'svd'
        let animationProgress = 0;
        let svdStage = 0; // 0: V^T, 1: Sigma, 2: U
        
        // SVD ë¶„í•´ ê²°ê³¼
        let matA, matU, matSigma, matVT;
        
        // ì›ë³¸ ë„í˜•
        let unitCircle = [];
        let gridLines = [];
        
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const SCALE = 50; // í”½ì…€/ë‹¨ìœ„

        // ========== p5.js ì´ˆê¸°í™” ==========
        function setup() {
            let canvas = createCanvas(700, 700);
            canvas.parent('canvas-container');
            
            // ë‹¨ìœ„ì› ìƒì„± (100ê°œ ì )
            for (let i = 0; i < 100; i++) {
                let angle = (TWO_PI / 100) * i;
                unitCircle.push(createVector(cos(angle), sin(angle)));
            }
            
            // ê²©ìì„  ìƒì„±
            for (let i = -5; i <= 5; i++) {
                // ìˆ˜ì§ì„ 
                let vLine = [];
                for (let j = -5; j <= 5; j += 0.1) {
                    vLine.push(createVector(i, j));
                }
                gridLines.push(vLine);
                
                // ìˆ˜í‰ì„ 
                let hLine = [];
                for (let j = -5; j <= 5; j += 0.1) {
                    hLine.push(createVector(j, i));
                }
                gridLines.push(hLine);
            }
            
            // ì´ˆê¸° SVD ê³„ì‚°
            calculateSVD();
        }

        // ========== p5.js ë©”ì¸ ë£¨í”„ ==========
        function draw() {
            background(240);
            
            // ì¢Œí‘œê³„ ì„¤ì • (ì¤‘ì•™ ì›ì , Yì¶• ìœ„ìª½)
            translate(width/2, height/2);
            scale(1, -1);
            
            // ì¶• ê·¸ë¦¬ê¸°
            drawAxis();
            
            // ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸
            if (isAnimating) {
                updateAnimation();
            }
            
            // ë„í˜• ê·¸ë¦¬ê¸°
            drawShapes();
        }

        // ========== SVD ê³„ì‚° ==========
        function calculateSVD() {
            let a11 = parseFloat(document.getElementById('a11').value) || 0;
            let a12 = parseFloat(document.getElementById('a12').value) || 0;
            let a21 = parseFloat(document.getElementById('a21').value) || 0;
            let a22 = parseFloat(document.getElementById('a22').value) || 0;
            
            matA = [[a11, a12], [a21, a22]];
            
            try {
                let A = math.matrix(matA);
                let svd = math.svd(A);
                
                matU = svd.U.toArray();
                matSigma = [[svd.q[0], 0], [0, svd.q[1]]];
                matVT = math.transpose(svd.V).toArray();
                
                displaySVD();
            } catch(e) {
                console.error('SVD ê³„ì‚° ì˜¤ë¥˜:', e);
            }
        }

        // ========== í–‰ë ¬ ë³€í™˜ í•¨ìˆ˜ ==========
        function transform(point, matrix) {
            let x = point.x * matrix[0][0] + point.y * matrix[0][1];
            let y = point.x * matrix[1][0] + point.y * matrix[1][1];
            return createVector(x, y);
        }

        function transformShape(shape, matrix) {
            if (shape[0] && shape[0].x !== undefined) {
                // ë‹¨ìˆœ ì  ë°°ì—´
                return shape.map(p => transform(p, matrix));
            } else {
                // ì„  ë°°ì—´
                return shape.map(line => line.map(p => transform(p, matrix)));
            }
        }

        function matMul(m1, m2) {
            return [
                [m1[0][0]*m2[0][0] + m1[0][1]*m2[1][0], m1[0][0]*m2[0][1] + m1[0][1]*m2[1][1]],
                [m1[1][0]*m2[0][0] + m1[1][1]*m2[1][0], m1[1][0]*m2[0][1] + m1[1][1]*m2[1][1]]
            ];
        }

        // ========== ë³´ê°„ í•¨ìˆ˜ ==========
        function lerpShape(start, end, t) {
            if (start[0] && start[0].x !== undefined) {
                // ì  ë°°ì—´
                return start.map((p, i) => p5.Vector.lerp(p, end[i], t));
            } else {
                // ì„  ë°°ì—´
                return start.map((line, i) => 
                    line.map((p, j) => p5.Vector.lerp(p, end[i][j], t))
                );
            }
        }

        // ========== ì• ë‹ˆë©”ì´ì…˜ ì œì–´ ==========
        function startDirect() {
            calculateSVD();
            isAnimating = true;
            animationMode = 'direct';
            animationProgress = 0;
            svdStage = 0;
            updateStatus('ì§ì ‘ ë³€í™˜ ì§„í–‰ ì¤‘...');
        }

        function startSVD() {
            calculateSVD();
            isAnimating = true;
            animationMode = 'svd';
            animationProgress = 0;
            svdStage = 0;
            updateStatus('SVD 1/3 ë‹¨ê³„: V^T íšŒì „');
        }

        function reset() {
            isAnimating = false;
            animationMode = null;
            animationProgress = 0;
            svdStage = 0;
            updateStatus('ëŒ€ê¸° ì¤‘...');
            updateProgressBar(0);
        }

        function updateAnimation() {
            animationProgress += 0.02;
            
            if (animationProgress >= 1) {
                if (animationMode === 'svd' && svdStage < 2) {
                    // ë‹¤ìŒ SVD ë‹¨ê³„ë¡œ
                    svdStage++;
                    animationProgress = 0;
                    
                    let stages = ['V^T íšŒì „', 'Î£ ìŠ¤ì¼€ì¼', 'U íšŒì „'];
                    updateStatus(`SVD ${svdStage+1}/3 ë‹¨ê³„: ${stages[svdStage]}`);
                } else {
                    // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ
                    isAnimating = false;
                    animationProgress = 1;
                    updateStatus('ë³€í™˜ ì™„ë£Œ!');
                }
            }
            
            // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸
            let totalProgress = animationMode === 'svd' ? 
                (svdStage + animationProgress) / 3 : animationProgress;
            updateProgressBar(totalProgress);
        }

        // ========== ê·¸ë¦¬ê¸° í•¨ìˆ˜ ==========
        function drawAxis() {
            stroke(200);
            strokeWeight(1);
            line(-width/2, 0, width/2, 0);
            line(0, -height/2, 0, height/2);
            
            // ëˆˆê¸ˆ
            fill(150);
            noStroke();
            textAlign(CENTER, CENTER);
            textSize(12);
            push();
            scale(1, -1);
            for (let i = -5; i <= 5; i++) {
                if (i !== 0) {
                    text(i, i * SCALE, 15);
                }
            }
            pop();
        }

        function drawShapes() {
            let currentCircle, currentGrid;
            
            if (!isAnimating) {
                // ì •ì§€ ìƒíƒœ - ì›ë³¸ í‘œì‹œ
                currentCircle = unitCircle;
                currentGrid = gridLines;
            } else {
                // ë³€í™˜ ê³„ì‚°
                let startCircle, endCircle, startGrid, endGrid;
                
                if (animationMode === 'direct') {
                    // ì§ì ‘ ë³€í™˜: ì›ë³¸ â†’ A
                    startCircle = unitCircle;
                    startGrid = gridLines;
                    endCircle = transformShape(unitCircle, matA);
                    endGrid = transformShape(gridLines, matA);
                    
                } else if (animationMode === 'svd') {
                    if (svdStage === 0) {
                        // 1ë‹¨ê³„: ì›ë³¸ â†’ V^T
                        startCircle = unitCircle;
                        startGrid = gridLines;
                        endCircle = transformShape(unitCircle, matVT);
                        endGrid = transformShape(gridLines, matVT);
                        
                    } else if (svdStage === 1) {
                        // 2ë‹¨ê³„: V^T â†’ Î£Â·V^T
                        let vt = matVT;
                        let sigmaVT = matMul(matSigma, matVT);
                        
                        startCircle = transformShape(unitCircle, vt);
                        startGrid = transformShape(gridLines, vt);
                        endCircle = transformShape(unitCircle, sigmaVT);
                        endGrid = transformShape(gridLines, sigmaVT);
                        
                    } else {
                        // 3ë‹¨ê³„: Î£Â·V^T â†’ UÂ·Î£Â·V^T = A
                        let sigmaVT = matMul(matSigma, matVT);
                        
                        startCircle = transformShape(unitCircle, sigmaVT);
                        startGrid = transformShape(gridLines, sigmaVT);
                        endCircle = transformShape(unitCircle, matA);
                        endGrid = transformShape(gridLines, matA);
                    }
                }
                
                // ë³´ê°„
                currentCircle = lerpShape(startCircle, endCircle, animationProgress);
                currentGrid = lerpShape(startGrid, endGrid, animationProgress);
            }
            
            // ê²©ì ê·¸ë¦¬ê¸°
            stroke(100, 150, 255, 100);
            strokeWeight(1);
            for (let line of currentGrid) {
                beginShape();
                for (let p of line) {
                    vertex(p.x * SCALE, p.y * SCALE);
                }
                endShape();
            }
            
            // ì› ê·¸ë¦¬ê¸°
            stroke(0, 200, 100);
            strokeWeight(3);
            noFill();
            beginShape();
            for (let p of currentCircle) {
                vertex(p.x * SCALE, p.y * SCALE);
            }
            endShape(CLOSE);
            
            // ì›ì 
            fill(255, 0, 0);
            noStroke();
            circle(0, 0, 8);
        }

        // ========== UI ì—…ë°ì´íŠ¸ ==========
        function updateStatus(text) {
            document.getElementById('status').textContent = text;
        }

        function updateProgressBar(progress) {
            document.getElementById('progress').style.width = (progress * 100) + '%';
        }

        function displaySVD() {
            let html = `
                <div style="margin-bottom:10px">
                    <span class="info-label">A = </span>
                    [${matA[0][0].toFixed(2)}, ${matA[0][1].toFixed(2)}]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;[${matA[1][0].toFixed(2)}, ${matA[1][1].toFixed(2)}]
                </div>
                <div style="margin-bottom:10px">
                    <span class="info-label">U = </span>
                    [${matU[0][0].toFixed(2)}, ${matU[0][1].toFixed(2)}]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;[${matU[1][0].toFixed(2)}, ${matU[1][1].toFixed(2)}]
                </div>
                <div style="margin-bottom:10px">
                    <span class="info-label">Î£ = </span>
                    [${matSigma[0][0].toFixed(2)}, ${matSigma[0][1].toFixed(2)}]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;[${matSigma[1][0].toFixed(2)}, ${matSigma[1][1].toFixed(2)}]
                </div>
                <div>
                    <span class="info-label">V^T = </span>
                    [${matVT[0][0].toFixed(2)}, ${matVT[0][1].toFixed(2)}]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[${matVT[1][0].toFixed(2)}, ${matVT[1][1].toFixed(2)}]
                </div>
            `;
            document.getElementById('svd-result').innerHTML = html;
        }

        function preset(a, b, c, d) {
            document.getElementById('a11').value = a;
            document.getElementById('a12').value = b;
            document.getElementById('a21').value = c;
            document.getElementById('a22').value = d;
            calculateSVD();
        }

        // ì…ë ¥ê°’ ë³€ê²½ ì‹œ SVD ì¬ê³„ì‚°
        ['a11', 'a12', 'a21', 'a22'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateSVD);
        });
    </script>
</body>
</html>
